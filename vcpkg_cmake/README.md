<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /vcpkg_cmake/mdsource/README.source.md
To change this file edit the source file and then execute ./run_markdown_templates.sh.
-->

# vcpkg_cmake

 <!-- include: vcpkg_cmake. path: /vcpkg_cmake/mdsource/vcpkg_cmake.include.md -->
| Topic        | Detail                                                       |
| ------------ | ------------------------------------------------------------ |
| Directory    | [vcpkg_cmake](/vcpkg_cmake/)                                 |
| Purpose      | Demo how to build your tests using [vcpkg](https://github.com/microsoft/vcpkg) to obtain Catch2 and ApprovalTests.cpp.<p />A specific version of vcpkg is cloned automatically by CMake, via `FetchContent()` in the top level CMakeLists.txt, and then built inside your CMake build space.<p />The benefit of this approach for obtaining vcpkg is that the project can specify the exact version of vcpkg to use, and obtain it automatically - on all platforms. This keeps both build instructions and CI configurations simple.<p />The alternative would be to have to write instructions for developers to say how to manually obtain and build the required vcpkg version - which would be tedious and error-prone.<p />Note that the first time this is run in any given build space, there is a significant wait for vcpkg to be set up, but subsequent runs are much faster.<p />If you have multiple build spaces, vcpkg will be cloned and built multiple times, so this mechanism may be best used when you are only building one or two configurations.|
| Dependencies | ApprovalTests.cpp - obtained automatically by vcpkg<br/>Catch2 - obtained automatically by vcpkg |
| Mechanism    | Uses CMake's `FetchContent()` to obtain and build a specific version of vcpkg inside the build space.<p />Uses vcpkg's [manifest mode](https://vcpkg.readthedocs.io/en/latest/users/manifests/) to specify the dependencies. |
| More Detail  | See [ApprovalTests.cpp Vcpkg Integration docs](https://github.com/approvals/ApprovalTests.cpp/blob/master/doc/VcpkgIntegration.md#top) - TODO Update that page to add descriptive info for this example|
 <!-- endInclude -->

The vcpkg.json manifest file, which states dependencies, is:

 <!-- include: inc_vcpkg_cmake_vcpkg. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_vcpkg.include.md -->

```json
{
  "name": "approval-tests-vcpkg-cmake",
  "version": "0",
  "dependencies": [
    "catch2",
    "approval-tests-cpp"
  ]
}
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/vcpkg.json' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->

The top-level CMakeLists.txt file, which clones and builds vcpkg, is:

 <!-- include: inc_vcpkg_cmake_cmakelists. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_cmakelists.include.md -->

```cmake
cmake_minimum_required(VERSION 3.11)

include(FetchContent)
FetchContent_Declare(
        vcpkg
        GIT_REPOSITORY https://github.com/microsoft/vcpkg
        GIT_TAG b295670e4bab14debe88d92cd5364b21ce26232c # 2021-09-09
)
if (NOT DEFINED CMAKE_TOOLCHAIN_FILE)
    FetchContent_Populate(vcpkg)
    set(CMAKE_TOOLCHAIN_FILE "${vcpkg_SOURCE_DIR}/scripts/buildsystems/vcpkg.cmake")
endif ()

project(vcpkg_cmake CXX)

enable_testing()

add_subdirectory(tests)
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/CMakeLists.txt' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->

And the CMakeLists.txt that builds the tests is:

 <!-- include: inc_vcpkg_cmake_tests_cmakelists. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_tests_cmakelists.include.md -->

```cmake
add_executable(tests
        main.cpp
        tests.cpp
        )

find_path(approvaltests.cpp_INCLUDE_DIR
        NAMES "ApprovalTests.hpp")
target_include_directories(tests
        PRIVATE "${approvaltests.cpp_INCLUDE_DIR}"
        )

find_package(Catch2 REQUIRED)
target_link_libraries(tests
        PRIVATE Catch2::Catch2
        )

target_compile_features(tests PUBLIC cxx_std_11)
set_target_properties(tests PROPERTIES CXX_EXTENSIONS OFF)

add_test(
        NAME tests
        COMMAND tests
)
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/tests/CMakeLists.txt' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->

The build script - which notably contains no vcpkg-specific commands - is:

 <!-- include: inc_vcpkg_cmake_build. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_build.include.md -->

```bash
#!/bin/bash

# Force execution to halt if there are any errors in this script:
set -e
set -o pipefail

mkdir -p build
cd       build
cmake -DCMAKE_BUILD_TYPE=Debug ..
cmake --build .
ctest --output-on-failure . -C Debug
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/build.sh' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->
