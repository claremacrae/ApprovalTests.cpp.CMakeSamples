<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /vcpkg_cmake/mdsource/README.source.md
To change this file edit the source file and then execute ./run_markdown_templates.sh.
-->

# vcpkg_cmake

 <!-- include: vcpkg_cmake. path: /vcpkg_cmake/mdsource/vcpkg_cmake.include.md -->
**TODO** Update this for vcpkg

| Topic        | Detail                                                       |
| ------------ | ------------------------------------------------------------ |
| Directory    | [vcpkg_cmake](/vcpkg_cmake/)                                 |
| Purpose      | Demo how to build your tests using Conan's `cmake`  generator to download single headers for specific releases of ApprovalTests.cpp and Catch2.<br />The released headers of those dependencies will be downloaded inside your CMake build space, and will not be shown inside your IDE. |
| Dependencies | ApprovalTests.cpp - downloaded automatically by Conan<br/>Catch2 - downloaded automatically by Conan |
| Mechanism    | Uses Conan's [`cmake`](https://docs.conan.io/en/latest/integrations/build_system/cmake/cmake_generator.html) generator. |
| More Detail  | See [Example 2. Using Conan's cmake generator](https://github.com/approvals/ApprovalTests.cpp/blob/master/doc/ConanIntegration.md#example-2-using-conans-cmake-generator) |
 <!-- endInclude -->

The vcpkg.json file is:

 <!-- include: inc_vcpkg_cmake_vcpkg. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_vcpkg.include.md -->

```json
{
  "name": "approval-tests-vcpkg-cmake",
  "version": "0",
  "dependencies": [
    "catch2",
    "approval-tests-cpp"
  ]
}
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/vcpkg.json' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->

The top-level CMakeLists.txt file is:

 <!-- include: inc_vcpkg_cmake_cmakelists. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_cmakelists.include.md -->

```cmake
cmake_minimum_required(VERSION 3.11)

include(FetchContent)
FetchContent_Declare(
  vcpkg
  GIT_REPOSITORY https://github.com/microsoft/vcpkg
  GIT_TAG b295670e4bab14debe88d92cd5364b21ce26232c # 2021-09-09
)
if(NOT DEFINED CMAKE_TOOLCHAIN_FILE)
  FetchContent_Populate(vcpkg)
  set(CMAKE_TOOLCHAIN_FILE "${vcpkg_SOURCE_DIR}/scripts/buildsystems/vcpkg.cmake")
endif()

project(vcpkg_cmake CXX)

enable_testing()

add_subdirectory(tests)
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/CMakeLists.txt' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->

And the CMakeLists.txt that builds the tests is:

 <!-- include: inc_vcpkg_cmake_tests_cmakelists. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_tests_cmakelists.include.md -->

```cmake
add_executable(tests
  main.cpp
  tests.cpp
)

find_path(approvaltests.cpp_INCLUDE_DIR
  NAMES "ApprovalTests.hpp")
find_package(Catch2 REQUIRED)
target_include_directories(tests
  PRIVATE "${approvaltests.cpp_INCLUDE_DIR}"
)
target_link_libraries(tests
  PRIVATE Catch2::Catch2
)

target_compile_features(tests PUBLIC cxx_std_11)
set_target_properties(tests PROPERTIES CXX_EXTENSIONS OFF)

add_test(
  NAME tests
  COMMAND tests
)
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/tests/CMakeLists.txt' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->

The build script is:

 <!-- include: inc_vcpkg_cmake_build. path: /vcpkg_cmake/mdsource/inc_vcpkg_cmake_build.include.md -->

```bash
#!/bin/bash

# Force execution to halt if there are any errors in this script:
set -e
set -o pipefail

mkdir -p build
cd       build
cmake -DCMAKE_BUILD_TYPE=Debug ..
cmake --build .
ctest --output-on-failure . -C Debug
```
<sup><a href='https://github.com/claremacrae/ApprovalTests.cpp.CMakeSamples/blob/main/./vcpkg_cmake/build.sh' title='File snippet was copied from'>snippet source</a></sup>
 <!-- endInclude -->
